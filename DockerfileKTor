FROM eclipse-temurin:17-centos7 as build

RUN mkdir /app_build
COPY . /app_build

WORKDIR /app_build

RUN ./gradlew clean build

FROM eclipse-temurin:17-centos7

RUN mkdir /app
RUN mkdir /app/resources

COPY --from=build /app_build/ktor-monitoring/build/libs/ktor-monitoring*all.jar /app/ktor-monitoring.jar
COPY --from=build /app_build/ktor-monitoring/src/main/resources/ /app/resources/

WORKDIR /app

CMD ["sh", "-c", "java -jar ktor-monitoring.jar"]